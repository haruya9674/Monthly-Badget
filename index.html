<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>家計簿アプリ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4CAF93">

<style>
:root{
  --main:#4CAF93;
  --bg:#F5F7F6;
  --card:#ffffff;
  --text:#333;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
}
header{
  background:var(--main);
  color:#fff;
  padding:20px;
  font-size:26px;
  text-align:center;
  font-weight:bold;
}
.container{ padding:20px; }
button, select, input{
  width:100%;
  font-size:20px;
  padding:14px;
  margin-top:12px;
  border-radius:12px;
  border:none;
}
button{
  background:var(--main);
  color:#fff;
  font-weight:bold;
}
button.secondary{
  background:#ccc;
  color:#333;
}
.card{
  background:var(--card);
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,0.05);
}
.hidden{ display:none; }
.summary-item{
  display:flex;
  justify-content:space-between;
  font-size:20px;
  padding:10px 0;
  border-bottom:1px solid #eee;
}
.summary-item:last-child{ border:none; }
.lang{ font-size:18px; margin-bottom:10px; }
</style>
</head>

<body>

<header id="title">家計簿</header>

<div class="container">

<select id="langSelect" class="lang">
  <option value="ja">日本語</option>
  <option value="en">English</option>
  <option value="ko">한국어</option>
</select>

<!-- MENU -->
<div id="menu">
  <div class="card">
    <button onclick="showAdd()"></button>
    <button onclick="showSummary()" style="margin-top:16px;"></button>
  </div>
</div>

<!-- ADD -->
<div id="add" class="hidden">
  <div class="card">
    <h2 id="addTitle"></h2>
    <select id="category"></select>
    <input type="number" id="amount" placeholder="0">
    <button onclick="saveData()"></button>
    <button class="secondary" onclick="backMenu()"></button>
  </div>
</div>

<!-- SUMMARY -->
<div id="summary" class="hidden">
  <div class="card">
    <h2 id="summaryTitle"></h2>
    <select id="monthSelect" onchange="showResult()"></select>
    <div id="result"></div>
    <button class="secondary" onclick="backMenu()"></button>
  </div>
</div>

</div>

<script>
const texts={
  ja:{
    title:"家計簿",
    add:"支出を入力",
    summary:"集計を見る",
    addTitle:"支出入力",
    summaryTitle:"月別・カテゴリ別",
    back:"Menuに戻る",
    save:"保存",
    categories:[
      "食費","家賃","光熱費","インターネット","携帯料金",
      "学費","塾・補習校","買い物","ガソリン",
      "外食費","旅行費","その他"
    ]
  },
  en:{
    title:"Budget",
    add:"Add Expense",
    summary:"View Summary",
    addTitle:"Add Expense",
    summaryTitle:"Monthly Summary",
    back:"Back to Menu",
    save:"Save",
    categories:[
      "Food","Rent","Utilities","Internet","Mobile",
      "Education","Cram School","Shopping","Gas",
      "Eating Out","Travel","Other"
    ]
  },
  ko:{
    title:"가계부",
    add:"지출 입력",
    summary:"요약 보기",
    addTitle:"지출 입력",
    summaryTitle:"월별 요약",
    back:"메뉴로",
    save:"저장",
    categories:[
      "식비","월세","공과금","인터넷","휴대폰",
      "학비","학원","쇼핑","주유",
      "외식","여행","기타"
    ]
  }
};

let lang="ja";
let data=JSON.parse(localStorage.getItem("kakeibo")||"[]");

langSelect.onchange=()=>{lang=langSelect.value;render();};

function render(){
  const t=texts[lang];
  title.innerText=t.title;
  document.querySelector("#menu button:nth-child(1)").innerText=t.add;
  document.querySelector("#menu button:nth-child(2)").innerText=t.summary;
  addTitle.innerText=t.addTitle;
  summaryTitle.innerText=t.summaryTitle;
  document.querySelectorAll(".secondary").forEach(b=>b.innerText=t.back);
  document.querySelector("#add button:not(.secondary)").innerText=t.save;

  category.innerHTML="";
  t.categories.forEach(c=>{
    const o=document.createElement("option");
    o.text=c;
    category.add(o);
  });
  updateMonths();
}
render();

function showAdd(){hideAll();add.classList.remove("hidden");}
function showSummary(){hideAll();summary.classList.remove("hidden");showResult();}
function backMenu(){hideAll();menu.classList.remove("hidden");}
function hideAll(){
  menu.classList.add("hidden");
  add.classList.add("hidden");
  summary.classList.add("hidden");
}

function saveData(){
  if(!amount.value)return;
  data.push({
    month:new Date().toISOString().slice(0,7),
    category:category.value,
    amount:Number(amount.value)
  });
  localStorage.setItem("kakeibo",JSON.stringify(data));
  amount.value="";
  alert("Saved!");
}

function updateMonths(){
  const months=[...new Set(data.map(d=>d.month))];
  monthSelect.innerHTML="";
  months.forEach(m=>{
    const o=document.createElement("option");
    o.value=o.text=m;
    monthSelect.add(o);
  });
}

function showResult(){
  if(!monthSelect.value)return;
  const filtered=data.filter(d=>d.month===monthSelect.value);
  const sum={};
  filtered.forEach(d=>sum[d.category]=(sum[d.category]||0)+d.amount);

  let html="";
  Object.keys(sum).forEach(k=>{
    html+=`<div class="summary-item"><span>${k}</span><strong>${sum[k]}</strong></div>`;
  });
  result.innerHTML=html||"<p>データなし</p>";
}

/* PWA */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
