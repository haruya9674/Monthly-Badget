<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>

<style>
*{box-sizing:border-box}
body{
 margin:0;
 font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
 background:#fafafa;
 color:#222;
}
.hidden{display:none}

/* ===== HEADER ===== */
header{
 text-align:center;
 padding:16px 10px 10px;
 background:#fff;
 border-bottom:1px solid #ddd;
}
#month{
 font-size:14px;
 color:#666;
 margin-bottom:6px;
}
#total{
 font-size:32px;
 font-weight:700;
}

/* ===== BUTTONS ===== */
nav{
 display:flex;
 justify-content:space-around;
 padding:8px;
 background:#fff;
 border-bottom:1px solid #ddd;
}
button{
 padding:8px 12px;
 border:1px solid #ccc;
 background:#f5f5f5;
 border-radius:6px;
 font-size:13px;
}

/* ===== LIST ===== */
#list{
 padding:10px;
}
.expense{
 padding:6px 0;
 border-bottom:1px solid #eee;
 text-align:center;
}
.category{font-size:12px;color:#555}
.amount{font-size:16px;font-weight:600}
.date{font-size:11px;color:#888}

/* ===== FORM ===== */
#addView{
 padding:12px;
}
input,select{
 width:100%;
 padding:8px;
 margin-bottom:8px;
 font-size:14px;
}

/* ===== TRANSFER ===== */
#transferTotal{
 text-align:center;
 font-size:14px;
 color:#444;
 margin-top:8px;
}
</style>
</head>

<body>

<header>
 <div id="month"></div>
 <div id="total"></div>
 <div id="transferTotal"></div>
</header>

<nav>
 <button id="btnAdd">Add</button>
 <button id="btnExport">Export</button>
 <button id="btnImport">Import</button>
 <select id="lang">
  <option value="ja">日本語</option>
  <option value="en">English</option>
  <option value="ko">한국어</option>
 </select>
</nav>

<div id="list"></div>

<div id="addView" class="hidden">
 <input id="amount" type="number" placeholder="Amount">
 <select id="category"></select>
 <input id="other" class="hidden" placeholder="Category name">
 <input id="date" type="date">
 <button id="save">Save</button>
 <button id="back">Back</button>
</div>

<script>
/* ===== TEXT ===== */
const TEXT={
 ja:{add:"追加",save:"保存",back:"戻る",transfer:"家族間移動",month:"年 月",total:"合計"},
 en:{add:"Add",save:"Save",back:"Back",transfer:"Transfer",month:"Month",total:"Total"},
 ko:{add:"추가",save:"저장",back:"뒤로",transfer:"이체",month:"월",total:"합계"}
};

/* ===== CATEGORIES ===== */
const BASE_CAT={
 food:{ja:"食費",en:"Food",ko:"식비"},
 shopping:{ja:"買い物",en:"Shopping",ko:"쇼핑"},
 transfer:{ja:"家族間移動",en:"Transfer",ko:"이체"},
 other:{ja:"その他",en:"Other",ko:"기타"}
};
const CAT_KEY="cats";
let CATS=JSON.parse(localStorage.getItem(CAT_KEY))||BASE_CAT;

/* ===== DATA ===== */
const DATA_KEY="expenses";
let data=JSON.parse(localStorage.getItem(DATA_KEY))||[];

/* ===== STATE ===== */
let langVal="ja";

/* ===== ELEMENTS ===== */
const list=document.getElementById("list");
const totalEl=document.getElementById("total");
const transferEl=document.getElementById("transferTotal");
const monthEl=document.getElementById("month");

/* ===== RENDER ===== */
function render(){
 list.innerHTML="";
 let total=0, transfer=0;
 const now=new Date();

 data.forEach(x=>{
  const d=new Date(x.date);
  if(d.getMonth()!==now.getMonth())return;

  if(x.category==="transfer") transfer+=x.amount;
  else total+=x.amount;

  const label=CATS[x.category]?.[langVal]||x.category;
  list.innerHTML+=`
   <div class="expense">
    <div class="category">${label}</div>
    <div class="amount">${x.amount.toFixed(2)} MYR</div>
    <div class="date">${x.date}</div>
   </div>`;
 });

 monthEl.textContent=`${now.getFullYear()} / ${(now.getMonth()+1).toString().padStart(2,"0")}`;
 totalEl.textContent=`${TEXT[langVal].total}: ${total.toFixed(2)} MYR`;
 transferEl.textContent=`${TEXT[langVal].transfer}: ${transfer.toFixed(2)} MYR`;
}

/* ===== CATEGORY UI ===== */
function applyCats(){
 const sel=document.getElementById("category");
 sel.innerHTML="";
 Object.keys(CATS).forEach(k=>{
  sel.innerHTML+=`<option value="${k}">${CATS[k][langVal]||k}</option>`;
 });
 sel.innerHTML+=`<option value="_add">＋</option>`;
}

/* ===== EVENTS ===== */
btnAdd.onclick=()=>{
 addView.classList.remove("hidden");
};
back.onclick=()=>{
 addView.classList.add("hidden");
};
save.onclick=()=>{
 const cat=category.value;
 let finalCat=cat;
 if(cat==="_add"){
  const name=other.value.trim();
  if(!name)return;
  finalCat="c_"+Date.now();
  CATS[finalCat]={ja:name,en:name,ko:name};
  localStorage.setItem(CAT_KEY,JSON.stringify(CATS));
 }
 data.push({
  amount:Number(amount.value),
  category:finalCat,
  date:date.value
 });
 localStorage.setItem(DATA_KEY,JSON.stringify(data));
 addView.classList.add("hidden");
 render(); applyCats();
};
btnExport.onclick=()=>{
 const blob=new Blob([JSON.stringify(data)],{type:"application/json"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="family_expense.json";
 a.click();
};
btnImport.onclick=()=>{
 const i=document.createElement("input");
 i.type="file";
 i.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{
   const imported=JSON.parse(r.result);
   data=data.concat(imported);
   localStorage.setItem(DATA_KEY,JSON.stringify(data));
   render();
  };
  r.readAsText(e.target.files[0]);
 };
 i.click();
};
lang.onchange=e=>{
 langVal=e.target.value;
 applyCats(); render();
};

/* ===== INIT ===== */
applyCats(); render();
</script>

</body>
</html>
