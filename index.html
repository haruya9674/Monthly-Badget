<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Kakeibo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json?v=FINAL_1">
<meta name="theme-color" content="#4CAF93">

<!-- VERSION: FINAL_SAVE_2026_01_20 -->

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont;background:#F4F6F5}
header{background:#4CAF93;color:#fff;padding:18px;font-size:24px;text-align:center}
.container{padding:20px}
select,input,button{width:100%;padding:14px;font-size:18px;margin-top:12px;border-radius:12px;border:none}
input{border:1px solid #ccc;background:#fff}
button{background:#4CAF93;color:#fff;font-weight:bold}
button.back{background:#ccc;color:#333}
button.delete{background:#E57373}
.card{background:#fff;border-radius:16px;padding:20px;margin-bottom:20px}
.hidden{display:none}
.item{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
</style>
</head>

<body>

<header>å®¶è¨ˆç°¿</header>

<div class="container">

<div id="menu" class="card">
  <select id="currency">
    <option value="MYR">MYR</option>
    <option value="JPY">JPY</option>
    <option value="KRW">KRW</option>
    <option value="AUD">AUD</option>
  </select>
  <button onclick="openAdd()">æ”¯å‡ºã‚’å…¥åŠ›</button>
  <button onclick="openSummary()">é›†è¨ˆã‚’è¦‹ã‚‹</button>
</div>

<div id="add" class="card hidden">
  <select id="category">
    <option value="food">é£Ÿè²»</option>
    <option value="rent">å®¶è³ƒ</option>
    <option value="utilities">å…‰ç†±è²»</option>
    <option value="internet">ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ</option>
    <option value="phone">æºå¸¯</option>
    <option value="school">å­¦è²»</option>
    <option value="shopping">è²·ã„ç‰©</option>
    <option value="other">ãã®ä»–</option>
  </select>
  <input type="number" id="amount" placeholder="é‡‘é¡">
  <button onclick="save()">ä¿å­˜</button>
  <button class="back" onclick="back()">æˆ»ã‚‹</button>
</div>

<div id="summary" class="card hidden">
  <select id="month"></select>
  <div id="list"></div>
  <button class="back" onclick="back()">æˆ»ã‚‹</button>
</div>

</div>

<script>
/* ==== å¼·åˆ¶çš„ã«æœ€æ–°SWã‚’ä½¿ã† ==== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.getRegistrations().then(rs=>{
    rs.forEach(r=>r.unregister());
  });
}

/* ==== ãƒ‡ãƒ¼ã‚¿ ==== */
function load(){
  return JSON.parse(localStorage.getItem("kakeibo_data")||"[]");
}
function saveData(d){
  localStorage.setItem("kakeibo_data",JSON.stringify(d));
}

/* ==== ç”»é¢ ==== */
function openAdd(){
  menu.classList.add("hidden");
  add.classList.remove("hidden");
}
function openSummary(){
  menu.classList.add("hidden");
  summary.classList.remove("hidden");
  render();
}
function back(){
  add.classList.add("hidden");
  summary.classList.add("hidden");
  menu.classList.remove("hidden");
}

/* ==== ä¿å­˜ ==== */
function save(){
  const amountVal=Number(amount.value);
  if(!amountVal){alert("é‡‘é¡æœªå…¥åŠ›");return;}

  const data=load();
  const month=new Date().toISOString().slice(0,7);

  data.push({
    id:Date.now(),
    month,
    category:category.value,
    amount:amountVal
  });

  saveData(data);

  // ğŸ”´ ç¢ºèªãƒ­ã‚°
  console.log("AFTER SAVE:", load());

  amount.value="";
  alert("ä¿å­˜ã—ã¾ã—ãŸï¼ˆå®Ÿä¿å­˜ç¢ºèªæ¸ˆï¼‰");
}

/* ==== è¡¨ç¤º ==== */
function render(){
  const data=load();
  const months=[...new Set(data.map(d=>d.month))].sort().reverse();
  month.innerHTML=months.map(m=>`<option>${m}</option>`).join("");

  list.innerHTML=data
    .filter(d=>d.month===month.value)
    .map(d=>`
      <div class="item">
        <span>${d.category} : ${d.amount} ${currency.value}</span>
        <button class="delete" onclick="del(${d.id})">å‰Šé™¤</button>
      </div>
    `).join("");
}

month.onchange=render;

/* ==== å‰Šé™¤ ==== */
function del(id){
  const data=load().filter(d=>d.id!==id);
  saveData(data);
  render();
}
</script>

</body>
</html>
