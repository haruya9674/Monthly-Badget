<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:#f7f7f7;
  color:#222;
}

header{
  background:#fff;
  padding:12px;
  border-bottom:1px solid #ddd;
}

#monthLabel{
  font-size:14px;
  color:#666;
}

#totalAmount{
  font-size:20px;
  font-weight:bold;
  margin-top:4px;
}

#transferAmount{
  font-size:13px;
  color:#555;
  margin-top:2px;
}

nav{
  display:flex;
  gap:6px;
  padding:10px;
  background:#fff;
  border-bottom:1px solid #ddd;
}

button,select{
  padding:6px 10px;
  font-size:13px;
}

#list{
  padding:10px;
}

.item{
  background:#fff;
  padding:8px;
  margin-bottom:6px;
  border-radius:4px;
  border:1px solid #e0e0e0;
}

.item-category{
  font-size:13px;
  color:#444;
}

.item-amount{
  font-size:15px;
  font-weight:600;
}

.item-date{
  font-size:11px;
  color:#888;
}

#addView{
  padding:10px;
}

input,select{
  width:100%;
  padding:6px;
  margin-bottom:6px;
  font-size:14px;
}

.hidden{display:none}
</style>
</head>

<body>

<header>
  <div id="monthLabel"></div>
  <div id="totalAmount"></div>
  <div id="transferAmount"></div>
</header>

<nav>
  <button id="addBtn">Add</button>
  <button id="exportBtn">Export</button>
  <button id="importBtn">Import</button>
  <select id="lang">
    <option value="ja">日本語</option>
    <option value="en">English</option>
    <option value="ko">한국어</option>
  </select>
</nav>

<div id="list"></div>

<div id="addView" class="hidden">
  <input id="amount" type="number" placeholder="Amount">
  <select id="category"></select>
  <input id="customCategory" class="hidden" placeholder="Category name">
  <input id="date" type="date">
  <button id="saveBtn">Save</button>
  <button id="backBtn">Back</button>
</div>

<script>
/* ===== LANGUAGE ===== */
const TEXT={
  ja:{add:"追加",save:"保存",back:"戻る",total:"合計",transfer:"家族間移動"},
  en:{add:"Add",save:"Save",back:"Back",total:"Total",transfer:"Transfer"},
  ko:{add:"추가",save:"저장",back:"뒤로",total:"합계",transfer:"이체"}
};

/* ===== CATEGORY ===== */
const BASE_CAT={
  food:{ja:"食費",en:"Food",ko:"식비"},
  shopping:{ja:"買い物",en:"Shopping",ko:"쇼핑"},
  gas:{ja:"ガソリン代",en:"Gas",ko:"주유"},
  transfer:{ja:"家族間移動",en:"Transfer",ko:"이체"},
  other:{ja:"その他",en:"Other",ko:"기타"}
};

const CAT_KEY="cats";
let CATS=JSON.parse(localStorage.getItem(CAT_KEY))||BASE_CAT;

/* ===== DATA ===== */
const DATA_KEY="expenses";
let data=JSON.parse(localStorage.getItem(DATA_KEY))||[];

/* ===== STATE ===== */
let lang="ja";

/* ===== ELEMENT ===== */
const list=document.getElementById("list");

/* ===== RENDER ===== */
function render(){
  list.innerHTML="";
  let total=0;
  let transferTotal=0;
  const now=new Date();

  data.forEach(d=>{
    const m=new Date(d.date);
    if(m.getMonth()!==now.getMonth()||m.getFullYear()!==now.getFullYear())return;

    if(d.category==="transfer") transferTotal+=d.amount;
    else total+=d.amount;

    const label=CATS[d.category]?.[lang]||d.category;

    const div=document.createElement("div");
    div.className="item";
    div.innerHTML=`
      <div class="item-category">${label}</div>
      <div class="item-amount">${d.amount.toFixed(2)} MYR</div>
      <div class="item-date">${d.date}</div>
    `;
    list.appendChild(div);
  });

  document.getElementById("monthLabel").textContent=
    `${now.getFullYear()} / ${(now.getMonth()+1).toString().padStart(2,"0")}`;

  document.getElementById("totalAmount").textContent=
    `${TEXT[lang].total}: ${total.toFixed(2)} MYR`;

  document.getElementById("transferAmount").textContent=
    `${TEXT[lang].transfer}: ${transferTotal.toFixed(2)} MYR`;
}

/* ===== CATEGORY UI ===== */
function loadCategories(){
  const sel=document.getElementById("category");
  sel.innerHTML="";
  Object.keys(CATS).forEach(k=>{
    sel.innerHTML+=`<option value="${k}">${CATS[k][lang]}</option>`;
  });
  sel.innerHTML+=`<option value="_custom">＋</option>`;
}

/* ===== EVENTS ===== */
addBtn.onclick=()=>addView.classList.remove("hidden");
backBtn.onclick=()=>addView.classList.add("hidden");

category.onchange=()=>{
  customCategory.classList.toggle("hidden",category.value!=="_custom");
};

saveBtn.onclick=()=>{
  let cat=category.value;
  if(cat==="_custom"){
    const name=customCategory.value.trim();
    if(!name)return;
    cat="c_"+Date.now();
    CATS[cat]={ja:name,en:name,ko:name};
    localStorage.setItem(CAT_KEY,JSON.stringify(CATS));
  }
  data.push({amount:Number(amount.value),category:cat,date:date.value});
  localStorage.setItem(DATA_KEY,JSON.stringify(data));
  addView.classList.add("hidden");
  loadCategories();render();
};

exportBtn.onclick=()=>{
  const blob=new Blob([JSON.stringify(data)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="family_expense.json";
  a.click();
};

importBtn.onclick=()=>{
  const i=document.createElement("input");
  i.type="file";
  i.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{
      data=data.concat(JSON.parse(r.result));
      localStorage.setItem(DATA_KEY,JSON.stringify(data));
      render();
    };
    r.readAsText(e.target.files[0]);
  };
  i.click();
};

lang.onchange=e=>{
  lang=e.target.value;
  loadCategories();render();
};

/* ===== INIT ===== */
loadCategories();
render();
</script>

</body>
</html>
